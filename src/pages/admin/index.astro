---
import Layout from "@/layouts/Layout.astro"
import { db } from "@/database"
import { formatDate } from "@/utils"

const menus = await db.selectFrom("menu").selectAll().execute()
---

<Layout>
	<h1>Menus</h1>

	<ul id="menu-list">
		{
			menus.map((menu) => (
				<li>
					<p>
						{menu.name} - {menu.description}
					</p>
					{menu.created_at && <p>{formatDate(new Date(menu.created_at))}</p>}

					<a href={`/admin/menu/${menu.id}`}>edit</a>

					<form action={`/api/menu/${menu.id}`} method="post">
						<button type="submit">Hapus</button>
					</form>
				</li>
			))
		}
	</ul>

	<form
		action="/api/admin/menu"
		method="post"
		hx-post="/api/admin/menu"
		hx-target="#menu-list"
		hx-swap="beforeend"
	>
		<input type="text" placeholder="nama" name="menu_name" required />
		<textarea placeholder="nama" name="menu_description" required></textarea>

		<button type="submit">tambahkan menu baru</button>
	</form>

	<script src="htmx.org"></script>
</Layout>
